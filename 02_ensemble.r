#######################################################################################
#######################################################################################
#######################################################################################
#######################################################################################
# - [-] - Set Working Directory ----
setwd("C:/Users/jonat/Desktop/project.deeptxtgen")#create a data folder in wd...
#######################################################################################
#######################################################################################
#######################################################################################
#######################################################################################
library(reticulate)
use_python("C:/Users/jonat/Anaconda3/python.exe")
#######################################################################################
#######################################################################################
#######################################################################################
#######################################################################################
# - [-] - Required Packages ----
library(keras)
#library(tidyverse) 
library(dplyr)
library(readr)
library(stringr)
library(purrr)
library(tokenizers)
library(tm)
#library(tfdatasets)
library(data.table)
library(harrypotter)
#######################################################################################
#######################################################################################
#######################################################################################
#######################################################################################
# - [] - Load Trained Models ----
model_a <- load_model_hdf5(filepath = 'model1.h5', compile = TRUE)
model_b <- load_model_hdf5(filepath = 'model2.h5', compile = TRUE)
model_c <- load_model_hdf5(filepath = 'model3.h5', compile = TRUE)
#######################################################################################
#######################################################################################
#######################################################################################
#######################################################################################
# - [] - Ensemble the Models ----
shared_input <- layer_input(shape=(get_input_shape_at(model_a, 1) %>% unlist))
model_list   <- c(model_a(shared_input),model_b(shared_input),
                  model_c(shared_input))
main_output  <- layer_average(model_list)
model <- keras_model(
  inputs = c(shared_input), 
  outputs = c(main_output)
)
#######################################################################################
#######################################################################################
#######################################################################################
#######################################################################################
# - [] - Save the Model ----
model %>% save_model_hdf5("model_final.h5", include_optimizer = TRUE)
load_model_hdf5("model_final.h5", compile = TRUE)
#######################################################################################
#######################################################################################
#######################################################################################
#######################################################################################